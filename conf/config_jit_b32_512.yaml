# JiT-B/32 @ 512x512 Configuration
# Base 模型 512 分辨率配置

trainer:
  max_epochs: 600
  accelerator: gpu
  devices: 8
  strategy: ddp
  precision: bf16-mixed
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1
  log_every_n_steps: 100
  enable_checkpointing: false
  enable_progress_bar: true
  enable_model_summary: true

model:
  class_path: models.modelmodule.JiTLightningModule
  init_args:
    model_name: JiT-B/32        # 32x32 patch for 512 resolution
    img_size: 512
    num_classes: 1000
    attn_dropout: 0.0
    proj_dropout: 0.0
    learning_rate: 0.00016
    weight_decay: 0.0
    ema_decay1: 0.9999
    ema_decay2: 0.9996
    P_mean: -0.8
    P_std: 0.8
    noise_scale: 2.0            # 512 图像使用更大的噪声
    t_eps: 0.05
    label_drop_prob: 0.1
    sampling_method: heun
    num_sampling_steps: 50
    cfg_scale: 2.9
    cfg_interval: [0.1, 1.0]

data:
  class_path: datas.datamodule.JiTDataModule
  init_args:
    data_path: ./data/imagenet
    img_size: 512               # 512 分辨率
    batch_size: 64              # 更大的图像需要更小的 batch_size
    num_workers: 12
    pin_memory: true

# callbacks:
#   - class_path: callbacks.jit_callbacks.EMACallback
#     init_args:
#       ema_decay1: 0.9999
#       ema_decay2: 0.9996

# logger:
#   class_path: lightning.pytorch.loggers.TensorBoardLogger
#   init_args:
#     save_dir: ./logs
#     name: jit_b32_512

seed_everything: 42

